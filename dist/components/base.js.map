{"version":3,"file":"base.js","sources":["../../src/components/base.ts"],"sourcesContent":["import { assert } from '@ember/debug';\nimport Component from '@glimmer/component';\nimport { type Changeset } from 'ember-immer-changeset';\nimport { isFieldError } from '../utils/is-field-error.ts';\n\nexport interface BaseValidationSignature {\n  Args: {\n    changeset: Changeset;\n    validationField: string;\n    mandatory?: boolean;\n    requiredFields?: string[];\n  };\n  Blocks: {\n    default: unknown[];\n  };\n}\n\nexport abstract class BaseValidationComponent<\n  T extends BaseValidationSignature,\n> extends Component<T> {\n  constructor(owner: unknown, args: T['Args']) {\n    super(owner, args);\n    assert('@changeset is required', typeof args.changeset === 'object');\n    assert(\n      '@validationField is required',\n      typeof args.validationField === 'string',\n    );\n  }\n\n  get hasError() {\n    return this.errors.length > 0;\n  }\n\n  get firstError(): Record<string, unknown> | undefined {\n    return this.errors[0];\n  }\n\n  get mandatory(): boolean {\n    if (this.args.mandatory !== undefined) {\n      return this.args.mandatory;\n    }\n\n    const requiredFields = this.args.requiredFields;\n    if (!requiredFields) {\n      return false;\n    }\n    return requiredFields.includes(this.args.validationField);\n  }\n\n  // dotted path only\n  get errors(): Record<string, unknown>[] {\n    return (\n      this.args.changeset.errors.filter((err) =>\n        isFieldError(this.args.validationField, err.key as string),\n      ) ?? []\n    );\n  }\n\n  get value() {\n    return this.args.changeset.get(this.args.validationField);\n  }\n}\n"],"names":["BaseValidationComponent","Component","constructor","owner","args","assert","changeset","validationField","hasError","errors","length","firstError","mandatory","undefined","requiredFields","includes","filter","err","isFieldError","key","value","get"],"mappings":";;;;;AAiBO,MAAeA,uBAAuB,SAEnCC,SAAS,CAAI;AACrBC,EAAAA,WAAWA,CAACC,KAAc,EAAEC,IAAe,EAAE;AAC3C,IAAA,KAAK,CAACD,KAAK,EAAEC,IAAI,CAAC,CAAA;IAClBC,MAAM,CAAC,wBAAwB,EAAE,OAAOD,IAAI,CAACE,SAAS,KAAK,QAAQ,CAAC,CAAA;IACpED,MAAM,CACJ,8BAA8B,EAC9B,OAAOD,IAAI,CAACG,eAAe,KAAK,QAClC,CAAC,CAAA;AACH,GAAA;EAEA,IAAIC,QAAQA,GAAG;AACb,IAAA,OAAO,IAAI,CAACC,MAAM,CAACC,MAAM,GAAG,CAAC,CAAA;AAC/B,GAAA;EAEA,IAAIC,UAAUA,GAAwC;AACpD,IAAA,OAAO,IAAI,CAACF,MAAM,CAAC,CAAC,CAAC,CAAA;AACvB,GAAA;EAEA,IAAIG,SAASA,GAAY;AACvB,IAAA,IAAI,IAAI,CAACR,IAAI,CAACQ,SAAS,KAAKC,SAAS,EAAE;AACrC,MAAA,OAAO,IAAI,CAACT,IAAI,CAACQ,SAAS,CAAA;AAC5B,KAAA;AAEA,IAAA,MAAME,cAAc,GAAG,IAAI,CAACV,IAAI,CAACU,cAAc,CAAA;IAC/C,IAAI,CAACA,cAAc,EAAE;AACnB,MAAA,OAAO,KAAK,CAAA;AACd,KAAA;IACA,OAAOA,cAAc,CAACC,QAAQ,CAAC,IAAI,CAACX,IAAI,CAACG,eAAe,CAAC,CAAA;AAC3D,GAAA;;AAEA;EACA,IAAIE,MAAMA,GAA8B;IACtC,OACE,IAAI,CAACL,IAAI,CAACE,SAAS,CAACG,MAAM,CAACO,MAAM,CAAEC,GAAG,IACpCC,YAAY,CAAC,IAAI,CAACd,IAAI,CAACG,eAAe,EAAEU,GAAG,CAACE,GAAa,CAC3D,CAAC,IAAI,EAAE,CAAA;AAEX,GAAA;EAEA,IAAIC,KAAKA,GAAG;AACV,IAAA,OAAO,IAAI,CAAChB,IAAI,CAACE,SAAS,CAACe,GAAG,CAAC,IAAI,CAACjB,IAAI,CAACG,eAAe,CAAC,CAAA;AAC3D,GAAA;AACF;;;;"}